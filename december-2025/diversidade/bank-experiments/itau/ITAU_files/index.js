(function(r,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(r=typeof globalThis!="undefined"?globalThis:r||self,c(r.SDKAnalytics_module={}))})(this,function(r){"use strict";var L=Object.defineProperty;var b=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var I=(r,c,a)=>c in r?L(r,c,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[c]=a,$=(r,c)=>{for(var a in c||(c={}))D.call(c,a)&&I(r,a,c[a]);if(b)for(var a of b(c))E.call(c,a)&&I(r,a,c[a]);return r};var P=(r,c)=>{var a={};for(var u in r)D.call(r,u)&&c.indexOf(u)<0&&(a[u]=r[u]);if(r!=null&&b)for(var u of b(r))c.indexOf(u)<0&&E.call(r,u)&&(a[u]=r[u]);return a};var m=(r,c,a)=>I(r,typeof c!="symbol"?c+"":c,a);var C=(r,c,a)=>new Promise((u,y)=>{var p=d=>{try{w(a.next(d))}catch(f){y(f)}},_=d=>{try{w(a.throw(d))}catch(f){y(f)}},w=d=>d.done?u(d.value):Promise.resolve(d.value).then(p,_);w((a=a.apply(r,c)).next())});class c{constructor(){m(this,"allowlist",!0);m(this,"allowlist_dev_environment",!1);m(this,"dual_tagging",!0);m(this,"gtm","");m(this,"use_sessionStorage",!1);m(this,"webview",!1);m(this,"engagement",null);m(this,"fullstory",null)}}const a="[SDK Analytics]",u={log(n,e,t){console.groupCollapsed(`${a} @[${n}]`),console.log(e,t||""),console.groupEnd()},success(n,e,t){console.groupCollapsed(`%c${a} SUCCESS @[${n}]`,"color:green"),console.log(e,t||""),console.groupEnd()},error(n,e,t){console.groupCollapsed(`%c${a} ERROR @[${n}]`,"color:red"),console.log(e,t||""),console.groupEnd()},warning(n,e,t){console.groupCollapsed(`%c${a} WARNING @[${n}]`,"color:orange"),console.log(e,t||""),console.groupEnd()}};class y{constructor(e){m(this,"instance");this.instance=e}set(e,t){return this.instance.setItem(e,JSON.stringify(t)),t}get(e){let t=this.instance.getItem(e);try{t=JSON.parse(t)}catch(o){}return t}remove(e){let t=this.get(e);return this.instance.removeItem(e),t}removeOnly(e,t){let o=this.get(e);return o&&(delete o[t],this.set(e,o)),o}removeList(e,t){let o=this.get(e);return o&&(t.forEach(i=>delete o[i]),this.set(e,o)),o}}const p={local:new y(window.localStorage)};var _={hom:"https://sdk-analytics-web-hom.cloud.itau.com.br"};const w=()=>{const n=window.location.search;if(!n)return"https://sdk-analytics-web.cloud.itau.com.br";const t=new URLSearchParams(n).get("sdk-analytics");return t&&t==="canary"?_.hom:"https://sdk-analytics-web.cloud.itau.com.br"},d=n=>new Promise((e,t)=>{const o=document.createElement("script");o.async=!0,o.src=n,o.onload=e,o.onerror=t,document.head.appendChild(o)}),f=({url:n,key:e,success:t,error:o=()=>null})=>{window.__SDKAnalyticsjsonp||(window.__SDKAnalyticsjsonp=v=>{var g=v,{filename:s}=g,l=P(g,["filename"]);const S=window.__SDKAnalyticsjsonp.stack.find(h=>h.key===s);S&&(S.success(l),window.__SDKAnalyticsjsonp.stack=window.__SDKAnalyticsjsonp.stack.filter(h=>h.key!==s))},window.__SDKAnalyticsjsonp.stack=[]),window.__SDKAnalyticsjsonp.stack.push({key:e,success:t});const i=document.createElement("script");i.async=!0,i.src=n,i.onload=()=>{},i.onerror=()=>{o()},document.head.appendChild(i)},j=n=>C(this,null,function*(){const{event_name:e,parameters:t,personalization:o}=n;if(!o)return null;if(o){const{dataSetIs:l,clientID:v}=o;if(!l&&e==="screen_view")return u.error("Engagement",'O "dataSetIs" é obrigatório e não foi informado.'),null;if(!v&&e==="screen_view"){if(u.log("Engagement",'O "clientID" não foi informado, o IS foi inicializado como área não logada.'),!p.local.get("anonId")){const g=O();p.local.set("anonId",g)}o.anonId=p.local.get("anonId")}}const i=`/${t.business_channel}/${t.environment}/${t.business}${t.custom_path}`,s=i.trim().replace(/^\/+|\/+$/g,"").replace(/\W/g,"-").replace(/^-+/g,"").toLowerCase();f({key:s,url:`https://www.itau.com.br/dual-tagging/${s}.js?version=23-09-2025`,success:l=>{if(l.is){const{clientID:v,dataSetIs:g,anonId:S}=o,h=K({action:i,clientID:v,anonId:S}),N=T(h.action),R=`https://itauunibanco2.us-4.evergage.com/api2/event/${g}?event=${N}`;return fetch(R,{headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})}).then(()=>u.success("Engagement",`Action enviada com sucesso para o IS. [${i}]`)).catch(W=>u.error("Engagement",W))}}})}),K=({action:n,clientID:e,anonId:t})=>{const o=e?"id":"anonId",i=e||t;return{action:{action:n,source:{channel:"Web"},itemAction:"View Item",catalog:{Category:{id:n.slice(1).replaceAll("/","|").toUpperCase()}},user:$({[o]:i},e&&{attributes:{clientID:e}})}}},T=n=>{let t=new TextEncoder().encode(JSON.stringify(n));return btoa(String.fromCharCode(...t))},O=()=>Array.from(crypto.getRandomValues(new Uint8Array(16)),n=>n.toString(36)).join("").substring(0,16),A="1.2.1",k=performance.now(),U=window.SDKAnalytics=function(n){u.log("Analytics Core","Info",{version:A}),n=Object.assign(new c,n);const e=n.webview?"Webview":"Web",t=w(),i=(n.webview?d(`${t}/webview.js`):d(`${t}/web.js`)).then(()=>(n.sdkWebLoadingDuration=performance.now()-k,window.SDKAnalytics[e](n))).then(s=>(n.sdkInitializationDuration=performance.now()-k,s));return{Track(s){i.then(l=>l.Track(s))},measurementTrack(s){i.then(l=>{l.measurementTrack&&l.measurementTrack(s)})},track(s){return i.then(l=>l.track(s))},observabilityInit(s){return i.then(l=>l.observabilityInit(s))},setDefaultParameters(s){return i.then(l=>l.setDefaultParameters(s))},setUserProperties(s){return i.then(l=>l.setUserProperties(s))},removeUserProperties(){i.then(s=>s.removeUserProperties())},removeDefaultParameter(s){i.then(l=>l.removeDefaultParameter(s))},removeDefaultParameters(s){i.then(l=>l.removeDefaultParameters(s))},removeAllDefaultParameters(){i.then(s=>s.removeAllDefaultParameters())}}};window.SDKAnalytics._sendEventPersonalization=n=>{if(!n||n.event_name!=="screen_view")return null;j(n)},r.default=U,r.version=A,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
